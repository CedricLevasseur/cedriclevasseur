/**
 * @fileoverview This program insert a random image using jquery library 
 * 
 * the configuration of the images to be randomly display are in the banner.json file
 * this file can contain either images (jpg, png) or flash
 * here is a example of the content of the banner.json file
 * <pre>
 * [
 	{"src":"http://www.numerikids.com/alpha/wp-content/uploads/2009/06/mario_bros.jpg",
 *	"link":"http://www.google.fr"},
 *	{"src":"http://monophonik.com/wp-content/uploads/2009/06/mario-wii.jpg",
 *	"link":"http://www.bing.com"},
 *	{"src":"http://www.nintendolesite.com/images/news/news_Nouveau_Mario_en_approche_titre.jpg",
 *	"link":"http://www.yahoo.fr"},
 *	{"src":"http://www.vidalonline.com/vidal-theme/images/pub.swf",
 *	"link":"",
 *	"width":"728",
 *	"height":"90"
 *	}
 * ]
 * </pre>
 *
 * To install in your website :
 * <ol>
 * 	<li> configure the multiple banners in the banner.json file 
 * 	<li> create a &lt;div id="banner"&gt;&lt;/div&gt; in your html file  
 * 	<li> load jquery in your html file
 * 	<li> load this banner.js in your html file and call rotateBanner() 
 * </ol>
 *
 * @author CÃ©dric Levasseur
 * @version 1.0
 *
 */


/**
 * The bootstrap which load the script
 */
$(document).ready(function() {
  rotateBanner();
});


/**
 * rotateBanner is the main function of this script. It is loaded when
 * the html document finished to load by a bootstrap.
 * @param {object} target a html element, member of the Document Object Model. If empty, it use &lt;div id="banner"&gt;
 * this method call for a banner.json file
 */
function rotateBanner(target){
	//loadJQuery();
	if(typeof target === 'undefined' || !target) {
		target=$("#banner");
	}
	$.getJSON('banner.json', function(data) {
		elem=randomize(data);
		insertElement(target,elem);
	});
}

/**
 * To prevent multiple load of jquery
 * NO LONGER USED, be sure to load JQUERY before using this  banner.js
 * @private
 * @deprecated
 */
window.onload = function () {

	 function loadJQuery(){
	  if (window.jQuery === undefined) {
	    var script = document.createElement('script');
	    script.src = 'http://code.jquery.com/jquery-latest.min.js';
	    document.getElementsByTagName('head')[0].appendChild(script); // load jQuery
	  }
	}

}




/**
 * randomize a data in this data array
 * @private
 * @param {array} data the array generated by reading the json file
 */
function randomize(data){
	var numLow = 0;
	var numHigh = data.length-1;
	var adjustedHigh = (parseFloat(numHigh) - parseFloat(numLow)) + 1;
	var numRand = Math.floor(Math.random()*adjustedHigh) + parseFloat(numLow);
	return data[numRand];
}


/**
 * insert the Element (image or flash) in the &lt;div id="banner"&gt;
 * @private
 * @param {object} target a html element, member of the Document Object Model
 * @param {object} a item of a data (img or flash)
 *
 */
function insertElement(target,elem){
	ext=elem.src.substring(elem.src.length-3, elem.src.length);
	if(ext=='swf'){
		target.append('<object width="'+elem.width+'" height="'+elem.height+'"data="'+elem.src+'" type="application/x-shockwave-flash"><param value="'+elem.src+'" name="movie"><param value="true" name="loop"></object>');	
	}else{
		// jpg or png
		target.append("<a href='"+elem.link+"'><img src='"+elem.src+"' /></a>");
	}
}
